---
title: Parse API
description: Comark provides functions to convert Comark (Components in Markdown) content into an Abstract Syntax Tree (AST).
---

## String Parsing

### `parse(source: string): ParseResult`{lang="ts"}

Parses Comark content from a string and returns the complete parsed structure.

**Parameters:**
- `source` - The markdown/Comark content as a string
- `options?` - Parser options including plugins

**Returns:** `ComarkTree` object containing:
- `nodes` - The parsed Comark AST nodes
- `frontmatter` - Frontmatter data parsed from YAML
- `meta` - Additional metadata from plugins (e.g., `toc`, `summary`)

**Example:**

```typescript
import { parse } from 'comark'

const content = `---
title: Hello World
description: A simple example
---

# Hello World

This is a **markdown** document with *Comark* components.

::alert{type="info"}
This is an alert component
::
`

const result = await parse(content)

console.log(result.nodes)      // Comark AST nodes
console.log(result.frontmatter) // { title: 'Hello World', description: 'A simple example' }
console.log(result.meta.toc)    // Table of contents (from toc plugin)
console.log(result.meta.summary) // Summary (from summary plugin, if used)
```

## Stream Parsing

### `parseStream(stream: Readable | ReadableStream<Uint8Array>): Promise<ComarkTree>`{lang=ts}

Asynchronously parses Comark content from a Node.js Readable stream or Web ReadableStream. The function waits for the entire stream to complete before parsing.

**Parameters:**
- `stream` - A Node.js Readable stream or Web ReadableStream containing Comark content

**Returns:** Promise resolving to `ComarkTree`

**Example with Node.js stream:**

```typescript
import { createReadStream } from 'node:fs'
import { parseStream } from 'comark/stream'

const stream = createReadStream('content.md')
const result = await parseStream(stream)

console.log(result.nodes)
console.log(result.frontmatter)
console.log(result.meta.toc)
```

**Example with Web stream (Fetch API):**

```typescript
import { parseStream } from 'comark/stream'

const response = await fetch('https://example.com/content.md')
const result = await parseStream(response.body!)

console.log(result.nodes)
```

### `parseStreamIncremental(stream: Readable | ReadableStream<Uint8Array>): AsyncGenerator<IncrementalParseResult>`

Parses Comark content incrementally as chunks arrive from the stream. This is ideal for real-time UI updates during streaming.

**Features:**
- Yields results after each chunk is received
- Automatically applies auto-close to handle incomplete syntax
- Provides progress tracking through chunk information
- Final result includes complete TOC

**Parameters:**
- `stream` - A Node.js Readable stream or Web ReadableStream

**Yields:** `IncrementalParseResult` for each chunk:
- `chunk` - The chunk that was just processed (string)
- `content` - The accumulated content (string)
- `body` - Current state of the parsed Comark AST
- `data` - Frontmatter data (available once parsed)
- `isComplete` - Boolean indicating if stream is complete
- `meta` - Metadata from plugins (includes `toc`, `summary` if plugins are enabled)

**Example:**

```typescript
import { parseStreamIncremental } from 'comark/stream'

const response = await fetch('https://example.com/article.md')

for await (const result of parseStreamIncremental(response.body!)) {
  if (!result.isComplete) {
    // Update UI as chunks arrive
    console.log(`Received chunk: ${result.chunk.length} bytes`)
    console.log(`Current elements: ${result.body.value.length}`)
    renderPartialContent(result.body)
  }
  else {
    // Final result with complete TOC
    console.log('Stream complete!')
    console.log('TOC:', result.toc)
    renderFinalContent(result.body)
  }
}
```

**Example with progress tracking:**

```typescript
import { parseStreamIncremental } from 'comark/stream'

let totalBytes = 0
let chunkCount = 0

for await (const result of parseStreamIncremental(stream)) {
  if (!result.isComplete) {
    totalBytes += result.chunk.length
    chunkCount++

    console.log(`Progress: ${chunkCount} chunks, ${totalBytes} bytes`)
    console.log(`Parsed ${result.body.value.length} elements so far`)
  }
}
```

## Types

### `ComarkTree`

The main return type for all parse functions.

```typescript
interface ComarkTree {
  nodes: ComarkNode[]          // The parsed AST nodes
  frontmatter: Record<string, any>  // YAML frontmatter data
  meta: {
    toc?: any                  // Table of contents (from toc plugin)
    summary?: ComarkNode[]     // Summary content (from summary plugin)
    [key: string]: any         // Other plugin metadata
  }
}
```

### `IncrementalParseResult`

Result type for incremental stream parsing.

```typescript
interface IncrementalParseResult {
  chunk: string                // The chunk just received
  content: string              // The accumulated content
  body: ComarkTree             // Current parsed state
  data: any                    // Frontmatter data (once available)
  isComplete: boolean          // Whether stream is finished
  meta: Record<string, any>    // Plugin metadata
}
```

### `ComarkNode`

```typescript
type ComarkNode = ComarkElement | ComarkText

type ComarkText = string

type ComarkElement = [string, ComarkElementAttributes, ...ComarkNode[]]

type ComarkElementAttributes = {
  [key: string]: unknown
}
```

## Processing Multiple Files

```typescript
import { createReadStream } from 'node:fs'
import { readdir } from 'node:fs/promises'
import { join } from 'node:path'
import { parseStream } from 'comark/stream'

async function processMarkdownDirectory(dir: string) {
  const files = await readdir(dir)
  const mdFiles = files.filter(f => f.endsWith('.md'))

  const results = await Promise.all(
    mdFiles.map(async (file) => {
      const stream = createReadStream(join(dir, file))
      const result = await parseStream(stream)
      return { file, result }
    })
  )

  return results
}

// Usage
const results = await processMarkdownDirectory('./content')
console.log(`Processed ${results.length} files`)
```

## Chunked Stream Processing

```typescript
import { Readable } from 'node:stream'
import { parseStream } from 'comark/stream'

// Create a stream from chunks
const chunks = [
  '# Hello World\n\n',
  'This is some content.\n\n',
  '::alert{type="info"}\n',
  'Important message\n',
  '::\n'
]

const stream = Readable.from(chunks)
const result = await parseStream(stream)

console.log(result.body)
```

## Frontmatter Parsing

The parse functions automatically extract and parse YAML frontmatter:

```typescript
const content = `---
title: My Document
tags:
  - javascript
  - markdown
author:
  name: John Doe
  email: john@example.com
---

# Content here
`

const result = await parse(content)

console.log(result.data)
// {
//   title: 'My Document',
//   tags: ['javascript', 'markdown'],
//   author: { name: 'John Doe', email: 'john@example.com' }
// }
```

## Table of Contents

The parse functions automatically generate a table of contents based on headings:

```typescript
const content = `# Main Title

## Section 1

Some content here.

### Subsection 1.1

More content.

## Section 2

Final content.
`

const result = await parse(content)

console.log(result.toc)
// {
//   title: 'Main Title',
//   depth: 2,
//   searchDepth: 2,
//   links: [
//     { id: 'section-1', text: 'Section 1', depth: 2, children: [
//       { id: 'subsection-11', text: 'Subsection 1.1', depth: 3 }
//     ]},
//     { id: 'section-2', text: 'Section 2', depth: 2 }
//   ]
// }
```

## Summary Extraction

::callout{type="info"}
Summary extraction requires the [summary plugin](/plugins/summary). It's included in the `essentials` preset.
::

Content before the `<!-- more -->` comment is extracted as a summary when using the summary plugin:

```typescript
import { parse } from 'comark'
import comarkSummary from 'comark/plugins/summary'

const content = `# Article Title

This is the introduction paragraph that will be used as a summary.

<!-- more -->

This is the full article content that won't appear in the summary.
`

const result = await parse(content, {
  plugins: [comarkSummary()]
})

console.log(result.meta.summary)
// ComarkNode[] with only the content before <!-- more -->
```

## Error Handling

```typescript
import { parseStream } from 'comark/stream'

try {
  const stream = createReadStream('content.md')
  const result = await parseStream(stream)
  console.log('Parsed successfully:', result.body)
}
catch (error) {
  console.error('Parse error:', error)
}
```

## Performance Tips

1. **Use streaming for large files**: For files larger than 1MB, use `parseStream` instead of reading the entire file into memory first.

2. **Use incremental parsing for real-time updates**: When you need to update the UI during streaming (e.g., AI-generated content), use `parseStreamIncremental`.

3. **Batch process multiple files**: Use `Promise.all()` to parse multiple files in parallel.

4. **Cache parsed results**: If parsing the same content multiple times, cache the `ParseResult` to avoid redundant parsing.

```typescript
// Good: Stream large files
const result = await parseStream(createReadStream('large-file.md'))

// Avoid: Loading entire large file into memory
const content = await readFile('large-file.md', 'utf-8') // Don't do this for large files
const result = await parse(content)
```

## See Also

- [Auto-Close API](/api/auto-close) - Handling incomplete syntax
- [API Reference](/api/reference) - Quick reference for all exports
- [Vue Renderer](/rendering/vue) - Rendering parsed content in Vue
- [React Renderer](/rendering/react) - Rendering parsed content in React
