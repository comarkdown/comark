---
title: Parse API
description: Comark provides functions to convert Comark (Components in Markdown) content into an Abstract Syntax Tree (AST).
---

## String Parsing

### `parse(source: string): ComarkTree`{lang="ts"}

Parses Comark content from a string and returns the complete parsed structure.

**Parameters:**
- `source` - The markdown/Comark content as a string
- `options?` - Parser options including plugins

**Returns:** `ComarkTree` object containing:
- `nodes` - The parsed Comark AST nodes
- `frontmatter` - Frontmatter data parsed from YAML
- `meta` - Additional metadata from plugins (e.g., `toc`, `summary`)

**Example:**

```typescript
import { parse } from 'comark'

const content = `---
title: Hello World
description: A simple example
---

# Hello World

This is a **markdown** document with *Comark* components.

::alert{type="info"}
This is an alert component
::
`

const result = await parse(content)

console.log(result.nodes)      // Comark AST nodes
console.log(result.frontmatter) // { title: 'Hello World', description: 'A simple example' }
console.log(result.meta.toc)    // Table of contents (from toc plugin)
console.log(result.meta.summary) // Summary (from summary plugin, if used)
```



## Types

### `ComarkTree`

The main return type for all parse functions.

```typescript
interface ComarkTree {
  nodes: ComarkNode[]          // The parsed AST nodes
  frontmatter: Record<string, any>  // YAML frontmatter data
  meta: {
    toc?: any                  // Table of contents (from toc plugin)
    summary?: ComarkNode[]     // Summary content (from summary plugin)
    [key: string]: any         // Other plugin metadata
  }
}
```


### `ComarkNode`

```typescript
type ComarkNode = ComarkElement | ComarkText

type ComarkText = string

type ComarkElement = [string, ComarkElementAttributes, ...ComarkNode[]]

type ComarkElementAttributes = {
  [key: string]: unknown
}
```

## Processing Multiple Files

```typescript
import { readdir, readFile } from 'node:fs/promises'
import { join } from 'node:path'
import { parse } from 'comark'

async function processMarkdownDirectory(dir: string) {
  const files = await readdir(dir)
  const mdFiles = files.filter(f => f.endsWith('.md'))

  const results = await Promise.all(
    mdFiles.map(async (file) => {
      const content = await readFile(join(dir, file), 'utf-8')
      const result = await parse(content)
      return { file, result }
    })
  )

  return results
}

// Usage
const results = await processMarkdownDirectory('./content')
console.log(`Processed ${results.length} files`)
```

## Frontmatter Parsing

The parse functions automatically extract and parse YAML frontmatter:

```typescript
const content = `---
title: My Document
tags:
  - javascript
  - markdown
author:
  name: John Doe
  email: john@example.com
---

# Content here
`

const result = await parse(content)

console.log(result.frontmatter)
// {
//   title: 'My Document',
//   tags: ['javascript', 'markdown'],
//   author: { name: 'John Doe', email: 'john@example.com' }
// }
```

## Table of Contents

The parse functions automatically generate a table of contents based on headings:

```typescript
const content = `# Main Title

## Section 1

Some content here.

### Subsection 1.1

More content.

## Section 2

Final content.
`

const result = await parse(content)

console.log(result.meta.toc)
// {
//   title: 'Main Title',
//   depth: 2,
//   searchDepth: 2,
//   links: [
//     { id: 'section-1', text: 'Section 1', depth: 2, children: [
//       { id: 'subsection-11', text: 'Subsection 1.1', depth: 3 }
//     ]},
//     { id: 'section-2', text: 'Section 2', depth: 2 }
//   ]
// }
```

## Summary Extraction

::callout{type="info"}
Summary extraction requires the [summary plugin](/plugins/summary).
::

Content before the `<!-- more -->` comment is extracted as a summary when using the summary plugin:

```typescript
import { parse } from 'comark'
import comarkSummary from 'comark/plugins/summary'

const content = `# Article Title

This is the introduction paragraph that will be used as a summary.

<!-- more -->

This is the full article content that won't appear in the summary.
`

const result = await parse(content, {
  plugins: [comarkSummary()]
})

console.log(result.meta.summary)
// ComarkNode[] with only the content before <!-- more -->
```

## Error Handling

```typescript
import { parse } from 'comark'
import { readFile } from 'node:fs/promises'

try {
  const content = await readFile('content.md', 'utf-8')
  const result = await parse(content)
  console.log('Parsed successfully:', result.nodes)
}
catch (error) {
  console.error('Parse error:', error)
}
```

## Performance Tips

1. **Batch process multiple files**: Use `Promise.all()` to parse multiple files in parallel.

2. **Cache parsed results**: If parsing the same content multiple times, cache the `ComarkTree` to avoid redundant parsing.

```typescript
// Good: Cache parsed results
const cache = new Map<string, ComarkTree>()

async function parseWithCache(content: string) {
  if (cache.has(content)) {
    return cache.get(content)!
  }
  const result = await parse(content)
  cache.set(content, result)
  return result
}
```

## See Also

- [Auto-Close API](/api/auto-close) - Handling incomplete syntax
- [API Reference](/api/reference) - Quick reference for all exports
- [Vue Renderer](/rendering/vue) - Rendering parsed content in Vue
- [React Renderer](/rendering/react) - Rendering parsed content in React
